<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metrics Tracker Test Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 3px;
        }
        button:hover {
            background: #0056b3;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
        }
        #log {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>üîç Metrics Tracker Test Page</h1>
    
    <div class="test-section">
        <h2>1. Library Status</h2>
        <button onclick="checkLibrary()">Check Library</button>
        <div id="libraryStatus"></div>
    </div>

    <div class="test-section">
        <h2>2. Test Auto-Tracking</h2>
        <p>Auto-tracking should fire on page load. Check console and network tab.</p>
        <button onclick="reloadPage()">Reload Page (Triggers Auto-Track)</button>
    </div>

    <div class="test-section">
        <h2>3. Test Manual Tracking</h2>
        <button onclick="testManualTrack()">Track Test Metric</button>
        <button onclick="testIncrement()">Increment Counter</button>
        <button onclick="testDecrement()">Decrement Gauge</button>
        <div id="manualStatus"></div>
    </div>

    <div class="test-section">
        <h2>4. Test Click Tracking</h2>
        <button data-track="button_clicks" data-value="1" data-label-button="test-button">
            Click Me (Auto-tracked)
        </button>
        <p>This button has <code>data-track="button_clicks"</code> attribute</p>
    </div>

    <div class="test-section">
        <h2>5. Test Form Submission</h2>
        <form data-track="form_submissions" data-value="1" data-label-form="test-form">
            <input type="text" placeholder="Enter something" />
            <button type="submit">Submit Form</button>
        </form>
    </div>

    <div class="test-section">
        <h2>6. Queue & Batch Status</h2>
        <button onclick="checkQueueStatus()">Check Status</button>
        <div id="queueStatus"></div>
    </div>

    <div class="test-section">
        <h2>7. Network Monitoring</h2>
        <p>Open DevTools (F12) ‚Üí Network tab ‚Üí Filter by "metrics"</p>
        <p>You should see POST requests to <code>/api/v1/metrics</code></p>
        <button onclick="flushMetrics()">Force Flush (Send Now)</button>
    </div>

    <div class="test-section">
        <h2>8. Activity Log</h2>
        <div id="log"></div>
        <button onclick="clearLog()">Clear Log</button>
    </div>

    <!-- PASTE YOUR GENERATED SNIPPET HERE -->
    <script>
        // ============================================
        // PASTE YOUR GENERATED CODE SNIPPET BELOW
        // ============================================
        
        // Your snippet goes here...
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'start':Date.now()});var f=d.getElementsByTagName(s)[0],j=d.createElement(s);j.async=true;j.src='http://localhost:3000/api/v1/tracker.js?k=mk_73c3fa5a2c4cc51bba8fbe00f985c070f7aa24d42548b3d600c62df9ff8e3a08&a=1&c=1';f.parentNode.insertBefore(j,f);})(window,document,'script','metricsTracker');
        
        // ============================================
        // END OF YOUR SNIPPET
        // ============================================

        // Test functions
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
            logDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[Test] ${message}`);
        }

        function checkLibrary() {
            const statusDiv = document.getElementById('libraryStatus');
            
            if (typeof window.MetricsTracker === 'undefined') {
                statusDiv.innerHTML = '<div class="status error">‚ùå MetricsTracker not loaded! Check if snippet is pasted correctly.</div>';
                log('Library check: FAILED - MetricsTracker not found', 'error');
                return;
            }

            const queueSize = window.MetricsTracker.getQueueSize();
            const batchSize = window.MetricsTracker.getBatchSize();
            
            statusDiv.innerHTML = `
                <div class="status success">
                    ‚úÖ Library Loaded Successfully!<br>
                    Queue Size: ${queueSize}<br>
                    Batch Size: ${batchSize}
                </div>
            `;
            log('Library check: SUCCESS', 'success');
        }

        function testManualTrack() {
            const statusDiv = document.getElementById('manualStatus');
            
            if (typeof window.MetricsTracker === 'undefined') {
                statusDiv.innerHTML = '<div class="status error">Library not loaded!</div>';
                return;
            }

            const result = window.MetricsTracker.track('test_metric', 42, { test: true, source: 'manual' });
            
            if (result) {
                statusDiv.innerHTML = '<div class="status success">‚úÖ Metric tracked successfully! Check network tab.</div>';
                log('Manual track: SUCCESS - test_metric = 42', 'success');
            } else {
                statusDiv.innerHTML = '<div class="status error">‚ùå Failed to track. Check if metric is configured.</div>';
                log('Manual track: FAILED - metric may not be configured', 'error');
            }
        }

        function testIncrement() {
            if (typeof window.MetricsTracker === 'undefined') return;
            
            const result = window.MetricsTracker.increment('test_counter', 1);
            log(`Increment test: ${result ? 'SUCCESS' : 'FAILED'}`, result ? 'success' : 'error');
        }

        function testDecrement() {
            if (typeof window.MetricsTracker === 'undefined') return;
            
            const result = window.MetricsTracker.decrement('test_gauge', 1);
            log(`Decrement test: ${result ? 'SUCCESS' : 'FAILED'}`, result ? 'success' : 'error');
        }

        function checkQueueStatus() {
            if (typeof window.MetricsTracker === 'undefined') {
                document.getElementById('queueStatus').innerHTML = '<div class="status error">Library not loaded!</div>';
                return;
            }

            const queueSize = window.MetricsTracker.getQueueSize();
            const batchSize = window.MetricsTracker.getBatchSize();
            
            document.getElementById('queueStatus').innerHTML = `
                <div class="status info">
                    Queue Size: ${queueSize}<br>
                    Batch Size: ${batchSize}<br>
                    ${batchSize > 0 ? '‚ö†Ô∏è Metrics are queued and will be sent soon' : '‚úÖ No pending metrics'}
                </div>
            `;
            log(`Queue status: Queue=${queueSize}, Batch=${batchSize}`);
        }

        function flushMetrics() {
            if (typeof window.MetricsTracker === 'undefined') return;
            
            window.MetricsTracker.flush();
            log('Force flush: Metrics sent immediately', 'success');
            
            setTimeout(() => {
                checkQueueStatus();
            }, 500);
        }

        function reloadPage() {
            log('Reloading page to test auto-tracking...', 'info');
            setTimeout(() => {
                window.location.reload();
            }, 500);
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        // Monitor network requests
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
            if (args[0] && args[0].includes && args[0].includes('/api/v1/metrics')) {
                log(`üì§ Sending metrics to: ${args[0]}`, 'success');
                
                return originalFetch.apply(this, args)
                    .then(response => {
                        if (response.ok) {
                            log(`‚úÖ Metrics sent successfully (${response.status})`, 'success');
                        } else {
                            log(`‚ùå Metrics send failed (${response.status})`, 'error');
                        }
                        return response;
                    })
                    .catch(error => {
                        log(`‚ùå Network error: ${error.message}`, 'error');
                        throw error;
                    });
            }
            return originalFetch.apply(this, args);
        };

        // Auto-check on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                checkLibrary();
                log('Page loaded - auto-tracking should have fired', 'info');
            }, 1000);
        });

        // Log when library loads
        const checkInterval = setInterval(() => {
            if (typeof window.MetricsTracker !== 'undefined') {
                log('‚úÖ MetricsTracker library loaded!', 'success');
                clearInterval(checkInterval);
            }
        }, 100);
    </script>
</body>
</html>